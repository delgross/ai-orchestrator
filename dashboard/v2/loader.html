<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Dashboard Loader</title>
</head>

<body>
    <h1>Updating Dashboard...</h1>
    <p>Please wait while we clear the application cache.</p>
    <script>
        // Force unregister all service workers
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                if (registrations.length === 0) {
                    console.log('No SW found, redirecting...');
                    window.location.replace('/v2/index.html?v=' + Date.now());
                    return;
                }

                let count = registrations.length;
                for (let registration of registrations) {
                    console.log('Unregistering SW:', registration);
                    registration.unregister().then(function () {
                        count--;
                        if (count === 0) {
                            console.log('All SWs unregistered, redirecting...');
                            setTimeout(() => {
                                window.location.replace('/v2/index.html?v=' + Date.now());
                            }, 500);
                        }
                    });
                }
            });
        } else {
            window.location.replace('/v2/index.html?v=' + Date.now());
        }
    </script>
</body>

</html>